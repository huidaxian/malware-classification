# coding=utf-8
'''
convert beye sequence to images
'''
import pandas as pd
import base64
from PIL import Image
import binascii
import sys
import numpy 
import matplotlib.pyplot as plt

from io import BytesIO


def getMatrixfrom_binary(filename,width):
    content = filename
    hexst = binascii.hexlify(content) #将二进制文件转换为十六进制字符串
    fh = numpy.array([int(hexst[i:i+2],16) for i in range(0, len(hexst), 2)]) #按字节分割
    rn = len(fh)/width
    print(rn)
    fh = numpy.reshape(fh[:rn*width],(-1,width)) #根据设定的宽度生成矩阵
    fh = numpy.uint8(fh)
    return fh
df = pd.read_csv('testing.csv')
print(df.shape)
labels = ['Android',
'Bashlite',
'BenignWare',
'Dofloo',
'Hajime',
'Mirai',
'Pnscan',
'Tsunami',
'Xorddos',
]
i=0
while(i<10899):
    sequence=df.iloc[i,1]
    label = df.iloc[i,2]
    for l in labels:
        if l==label:
            label=labels.index(l)


    

    sequence=base64.b64decode(sequence)
   
    
    name = './data/predict/'+str(i)+'.png'
    #name = './data/train/'+label+'_'+str(i)+'.png'

    im = Image.fromarray(getMatrixfrom_binary(sequence,64)) #转换为图像
    #print(name)
    im.save(name)
    i+=1
    
    
